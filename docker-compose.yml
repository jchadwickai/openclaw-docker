version: '3.8'

services:
  gateway:
    build:
      context: ./gateway
      dockerfile: Dockerfile
    container_name: openclaw-gateway
    restart: unless-stopped
    init: true
    user: "1000:1000"
    environment:
      - HOME=/home/node
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - BW_CLIENTID=${BW_CLIENTID}
      - BW_CLIENTSECRET=${BW_CLIENTSECRET}
      - BW_PASSWORD=${BW_PASSWORD}
    volumes:
      - openclaw-data:/home/node/.openclaw

  browser:
    build:
      context: ./browser
      dockerfile: Dockerfile
    container_name: openclaw-browser
    restart: unless-stopped
    ports:
      - "9222:9222"
    shm_size: 2g
    cap_add:
      - SYS_ADMIN

  cli:
    image: ghcr.io/openclaw/openclaw:2026.2.9
    container_name: openclaw-cli
    restart: unless-stopped
    command: sleep infinity
    environment:
      - HOME=/home/node
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
    volumes:
      - openclaw-data:/home/node/.openclaw

  syncthing:
    image: syncthing/syncthing:latest
    container_name: openclaw-syncthing
    restart: unless-stopped
    hostname: openclaw-sync
    environment:
      - PUID=1000
      - PGID=1000
    volumes:
      - openclaw-data:/data:rw
      - syncthing-config:/var/syncthing
      - ./syncthing/.stignore:/data/workspace/.stignore:ro
    ports:
      - "8384:8384"     # Web UI
      - "22000:22000/tcp" # TCP file transfers
      - "22000:22000/udp" # QUIC file transfers
      - "21027:21027/udp" # Receive local discovery broadcasts

volumes:
  openclaw-data:
    external: true
  syncthing-config: