version: '3.8'

services:
  openclaw-gateway:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: openclaw-gateway
    restart: unless-stopped
    init: true
    user: "1000:1000"
    environment:
      - HOME=/home/node
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
    volumes:
      - openclaw-data:/home/node/.openclaw

  syncthing:
    image: syncthing/syncthing:latest
    container_name: openclaw-syncthing
    restart: unless-stopped
    hostname: openclaw-sync
    environment:
      - PUID=1000
      - PGID=1000
    volumes:
      - openclaw-data:/data:rw
      - syncthing-config:/var/syncthing
      - ./syncthing/.stignore:/data/workspace/.stignore:ro
      - ./syncthing/config.xml:/config-template/config.xml:ro
      - ./syncthing/init.sh:/init.sh:ro
    entrypoint: ["/bin/sh", "/init.sh"]
    ports:
      - "8384:8384"     # Web UI
      - "22000:22000/tcp" # TCP file transfers
      - "22000:22000/udp" # QUIC file transfers
      - "21027:21027/udp" # Receive local discovery broadcasts

volumes:
  openclaw-data:
    external: true
  syncthing-config: