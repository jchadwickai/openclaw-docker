version: '3.8'

services:
  gateway:
    build:
      context: ./gateway
      dockerfile: Dockerfile
    restart: unless-stopped
    init: true
    user: "1000:1000"
    ports:
      - "18789:18789"
    depends_on:
      - ollama
    environment:
      - HOME=/home/node
      - BRAVE_API_KEY=${BRAVE_API_KEY}
      - BW_CLIENTID=${BW_CLIENTID}
      - BW_CLIENTSECRET=${BW_CLIENTSECRET}
      - BW_PASSWORD=${BW_PASSWORD}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - GOG_KEYRING_PASSWORD=${GOG_KEYRING_PASSWORD}
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN}
      - OLLAMA_API_KEY=ollama-local
    volumes:
      - openclaw:/home/node
      
  openclaw-setup:
    image: openclawai/openclaw:latest
    depends_on:
      - ollama
    environment:
      - OLLAMA_API_KEY=ollama-local
    volumes:
      - openclaw:/home/node/.openclaw 
      
  ollama:
    image: ollama/ollama:latest
    ports:
      - "11434:11434"
    environment:
      - OLLAMA_HOST=0.0.0.0:11434
      - OLLAMA_API_KEY=${OLLAMA_API_KEY}
    volumes:
      - ollama:/root/.ollama
    restart: unless-stopped
    
  browser:
    build:
      context: ./browser
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "9222:9222"
    shm_size: 2g
    cap_add:
      - SYS_ADMIN

  syncthing:
    image: syncthing/syncthing:latest
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
    volumes:
      - openclaw:/data:rw
      - syncthing:/var/syncthing
    ports:
      - "8384:8384"     # Web UI
      - "22000:22000/tcp" # TCP file transfers
      - "22000:22000/udp" # QUIC file transfers
      - "21027:21027/udp" # Receive local discovery broadcasts

volumes:
  openclaw:
  ollama:
  syncthing:
