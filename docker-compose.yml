version: '3.8'

services:
  openclaw-gateway:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: openclaw-gateway
    restart: unless-stopped
    init: true
    user: "1000:1000"
    environment:
      - HOME=/home/node
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
    volumes:
      - openclaw-data:/home/node/.openclaw

  openclaw-browser:
    image: mcr.microsoft.com/playwright:latest
    container_name: openclaw-browser
    command: >
      /bin/sh -c "
        playwright install &&
        xvfb-run --auto-servernum --server-args='-screen 0 1280x720x24' \
        chromium --remote-debugging-address=0.0.0.0 \
                 --remote-debugging-port=9222 \
                 --no-sandbox --disable-gpu --disable-dev-shm-usage
      "
    ports:
      - "9222:9222"
    shm_size: 1g
    cap_add:
      - SYS_ADMIN

  syncthing:
    image: syncthing/syncthing:latest
    container_name: openclaw-syncthing
    restart: unless-stopped
    hostname: openclaw-sync
    environment:
      - PUID=1000
      - PGID=1000
    volumes:
      - openclaw-data:/data:rw
      - syncthing-config:/var/syncthing
      - ./syncthing/.stignore:/data/workspace/.stignore:ro
    ports:
      - "8384:8384"     # Web UI
      - "22000:22000/tcp" # TCP file transfers
      - "22000:22000/udp" # QUIC file transfers
      - "21027:21027/udp" # Receive local discovery broadcasts

volumes:
  openclaw-data:
    external: true
  syncthing-config: